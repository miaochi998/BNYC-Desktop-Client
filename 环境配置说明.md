# 环境配置说明

## 📋 概述

本项目使用环境变量来配置访问地址，避免硬编码，便于在不同环境（开发/测试/生产）之间切换。

---

## 🔧 配置文件

### 1. **桌面客户端配置** (`desktop-client/.env`)

```bash
# Web应用URL
APP_URL=http://192.168.2.9:6201
```

**说明：**
- 此配置在**编译时**读取并嵌入到可执行文件中
- **修改后需要重新编译客户端**
- 用于指定桌面客户端加载的Web应用地址

**使用场景：**
- 开发/测试环境：使用局域网IP（如 `http://192.168.2.9:6201`）
- 生产环境：使用生产域名（如 `https://app.yourdomain.com`）

---

### 2. **Web前端配置** (`saas/customizer-web/.env.local`)

```bash
# API基础URL
VITE_API_BASE_URL=http://192.168.2.9:8000

# 应用标题
VITE_APP_TITLE=BNYC客户端定制系统

# 环境标识
VITE_APP_ENV=development
```

**说明：**
- 此配置在**运行时**读取，**无需重新编译**
- `.env.local` 文件不会提交到git，每个开发环境单独配置
- **修改后只需重启Vite开发服务器**

**使用场景：**
- 开发/测试环境：使用局域网IP（如 `http://192.168.2.9:8000`）
- 生产环境：使用生产API域名（如 `https://api.yourdomain.com`）

---

## 🚀 快速开始

### 首次配置

1. **配置Web前端：**
   ```bash
   cd saas/customizer-web
   cp .env.example .env.local
   # 编辑 .env.local，修改 VITE_API_BASE_URL 为实际的API地址
   ```

2. **配置桌面客户端：**
   ```bash
   cd desktop-client
   cp .env.example .env
   # 编辑 .env，修改 APP_URL 为实际的Web应用地址
   ```

### 应用配置更改

1. **Web前端配置更改：**
   ```bash
   # 修改 saas/customizer-web/.env.local
   # 重启服务即可生效
   bash saas/restart-all-local.sh
   ```

2. **桌面客户端配置更改：**
   ```bash
   # 修改 desktop-client/.env
   # 重新编译客户端
   cd desktop-client
   cargo tauri build  # 或使用GitHub Actions自动编译
   ```

---

## 📝 环境变量优先级

### Web前端（Vite）：
1. `.env.local` （最高优先级，不提交到git）
2. `.env` （通用配置）
3. 代码中的默认值 （最低优先级）

### 桌面客户端（Tauri/Rust）：
1. `.env` 文件中的配置（编译时读取）
2. 代码中的默认值（如果.env不存在）

---

## 🌍 不同环境的配置示例

### 本地开发（单机测试）
```bash
# Web前端 .env.local
VITE_API_BASE_URL=http://localhost:8000

# 桌面客户端 .env
APP_URL=http://localhost:6201
```

### 局域网测试（跨设备测试）
```bash
# Web前端 .env.local
VITE_API_BASE_URL=http://192.168.2.9:8000

# 桌面客户端 .env
APP_URL=http://192.168.2.9:6201
```

### 生产环境
```bash
# Web前端 .env.local
VITE_API_BASE_URL=https://api.yourdomain.com

# 桌面客户端 .env
APP_URL=https://app.yourdomain.com
```

---

## ⚠️ 注意事项

1. **安全性：**
   - `.env.local` 文件包含敏感配置，不要提交到git
   - 已在 `.gitignore` 中配置忽略

2. **桌面客户端：**
   - 修改 `desktop-client/.env` 后**必须重新编译**
   - GitHub Actions会自动读取此文件进行编译

3. **Web前端：**
   - 修改 `.env.local` 后只需**重启服务**
   - 浏览器可能需要硬刷新（Ctrl+F5）清除缓存

---

## 🔍 调试

### 查看当前配置

**Web前端（浏览器控制台）：**
```javascript
console.log('API Base URL:', import.meta.env.VITE_API_BASE_URL)
```

**桌面客户端（编译输出）：**
查看编译时的warning信息，会显示是否成功加载 `.env` 文件

---

## 📚 相关文档

- [Vite 环境变量文档](https://vitejs.dev/guide/env-and-mode.html)
- [Tauri 配置文档](https://tauri.app/v1/guides/building/app-icons)

